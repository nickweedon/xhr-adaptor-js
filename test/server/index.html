<html>

<head>
    <script type="text/javascript" src="../../bower_components/requirejs/require.js"></script>
    <script type="text/javascript" src="js/require-deps.js"></script>
    <link rel="stylesheet" href="css/colorbox.css">    
</head>

<body>
<h1>Output</h1>
<hr>
<div id="output"></div>

<input type="button" name="Send Request" value="Send Request" onclick="sendRequest()"/>

<script type="text/javascript">

	function sendRequest() {
		require(["jquery"], function() {
	        $.getJSON("data/jsonData.json", function(data) {
	        	console.debug("Receiving data: ", data);
	        	$("#output").html(JSON.stringify(data));
	        });
		});	
	}

	require(["xhr-adaptor-js", "jquery"], function(xhrAdaptorJs) {
		
		function XHRClass(impl) {
			
			xhrAdaptorJs.XHRWrapper.call(this, impl);
		};
	
		XHRClass.prototype = Object.create(xhrAdaptorJs.XHRWrapper.prototype);
		XHRClass.constructor = XHRClass;
		XHRClass.prototype.open = function(verb, url, async) {
            
            console.debug("Opening url '" + url + "''");
            xhrAdaptorJs.XHRWrapper.prototype.open.call(this, verb, url, async);
        };
		
        XHRClass.prototype.eventDelegate = {
        	onload : function () {
        		var me = this;
        		var onloadArgs = arguments;
        		require(["jquery-colorbox"], function() {
        			$.colorbox({
        				html:"<h1>Close to complete request</h1>",
        				onClosed : function () {
                			console.debug("Continuing request");
        					me.applyRealHandler(onloadArgs);		
        				}
        			});        			
        		});
        	}
        }

        xhrAdaptorJs.XHRManager.injectWrapper(XHRClass);
	});
</script>

    
</body>
</html>
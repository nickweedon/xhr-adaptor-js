<html>

<head>
    <script type="text/javascript" src="../bower_components/requirejs/require.js"></script>
    <script type="text/javascript" src="js/require-deps.js"></script>
    <link rel="stylesheet" href="css/colorbox.css">    
</head>

<body>
<h1>Output</h1>
<hr>
<div id="output"></div>



<script type="text/javascript">

	require(["xhr-adaptor-js", "jquery"], function(xhrAdaptorJs) {
		
		function XHRClass() {
			
			xhrAdaptorJs.xhrWrapper.call(this, new window.XMLHttpRequest());
			//xhrAdaptorJs.xhrWrapper.call(this, new ActiveXObject('MSXML2.XMLHTTP.3.0'));
		};
	
		XHRClass.prototype = Object.create(xhrAdaptorJs.xhrWrapper.prototype);
		XHRClass.constructor = XHRClass;
		XHRClass.prototype.open = function(verb, url, async) {
            
            console.debug("Jaarrr!!");
            xhrAdaptorJs.xhrWrapper.prototype.open.call(this, verb, url, async);
        };
		
        XHRClass.prototype.eventDelegate = {
        	onreadystatechange : function () {
        			console.debug("Calling orig!");
        			//this.realHandler.apply(this.realScope, arguments);
        			this.callRealHandler();
        	}
        }
        
        /*
		Object.defineProperty(XHRClass.prototype, "onreadystatechange", {
			set : function(value) {
				console.debug("Overriden setter");
			    var parentProp = Object.getOwnPropertyDescriptor(xhrAdaptorJs.xhrWrapper.prototype, "onreadystatechange");
			    parentProp.set.call(this, value);
			}
		})
		*/
		
		
		var xhrObj = new XHRClass();
		
        
		xhrObj.open("get", "data/jsonData.json", true);
        console.debug("Before xhrObj.onreadystatechange", xhrObj.onreadystatechange);

		xhrObj.onreadystatechange = function() {
            console.debug("State changed", this.readyState);
            console.debug("this", this);
            if(this.readyState == 4) {
            	console.debug("Response", this.responseText);
                $('#output').html(JSON.stringify(this.responseText));
            }
        }
		console.debug("After xhrObj.onreadystatechange", xhrObj.onreadystatechange);
		
		xhrObj.send();
		
	});
	
</script>

    
</body>
</html>